#!/bin/sh
for a in . .. ../.. ; do [ -e $a/tests.sh ] && . $a/tests.sh ; done

NAME="calc switch table"
FILE=../../bins/elf/calc.file
ARGS='-e anal.jmptbl=true'
CMDS="af@0x8049203
f~?switch"
EXPECT="7
"
run_test

NAME="mac-ls switch count"
FILE=../../bins/mach0/mac-ls
ARGS='-e anal.jmptbl=true -A'
CMDS="f~?switch"
EXPECT="2
"
run_test

NAME="mac-ls main switch"
FILE=../../bins/mach0/mac-ls
ARGS='-e anal.jmptbl=true'
CMDS="s main;af
f~switch
f~?case
"
EXPECT="0x1000011b5 1 switch.0x1000011b5
73
"
run_test

NAME="mac-ls switch count"
FILE=../../bins/mach0/mac-ls
ARGS='-e anal.jmptbl=true -A'
CMDS="f~?case"
EXPECT="83
"
run_test

FILE=../../bins/pe/test.exe
CMDS='e anal.jmptbl=true
s 0x402cb6
af
afb

'
EXPECT='0x00402cb6 0x00402d2c 00:0000 118 j 0x00402d57 f 0x00402d2c
0x00402d2c 0x00402d45 00:0000 25 j 0x00402d4f f 0x00402d45
0x00402d45 0x00402d4f 00:0000 10 j 0x00402d4f
0x00402d4f 0x00402d57 00:0000 8 j 0x0040388e
0x00402d57 0x00402d5d 00:0000 6 j 0x00402dbb f 0x00402d5d
0x00402d5d 0x00402d6e 00:0000 17 j 0x00402d89 f 0x00402d6e
0x00402d6e 0x00402d73 00:0000 5 j 0x00402d89 f 0x00402d73
0x00402d73 0x00402d89 00:0000 22 j 0x00402d8b
0x00402d89 0x00402d8b 00:0000 2 j 0x00402d8b
0x00402d8b 0x00402d91 00:0000 6 j 0x00402d2c f 0x00402d91
0x00402d91 0x00402d96 00:0000 5 j 0x00402daf f 0x00402d96
0x00402d96 0x00402d9b 00:0000 5 j 0x00402daf f 0x00402d9b
0x00402d9b 0x00402daf 00:0000 20 j 0x00402db1
0x00402daf 0x00402db1 00:0000 2 j 0x00402db1
0x00402db1 0x00402dbb 00:0000 10 j 0x00402d2c f 0x00402dbb
0x00402dbb 0x00402dc5 00:0000 10 j 0x00402d2c f 0x00402dc5
0x00402dc5 0x00402de7 00:0000 34 j 0x00403875 f 0x00402de7
0x00402de7 0x00402dfc 00:0000 21 j 0x00403875 f 0x00402dfc
0x00402dfc 0x00402e03 00:0000 7 j 0x00402e12 f 0x00402e03
0x00402e03 0x00402e12 00:0000 15 j 0x00402e14
0x00402e12 0x00402e14 00:0000 2 j 0x00402e14
0x00402e14 0x00402e30 00:0000 28 j 0x00403850 f 0x00402e30
0x00402e30 0x00402e37 00:0000 7
0x00402e37 0x00402e67 00:0000 48 j 0x00403850
0x00402e67 0x00402e6f 00:0000 8 j 0x00402eb9 f 0x00402e6f
0x00402e6f 0x00402e74 00:0000 5 j 0x00402eaa f 0x00402e74
0x00402e74 0x00402e79 00:0000 5 j 0x00402e9e f 0x00402e79
0x00402e79 0x00402e7d 00:0000 4 j 0x00402e92 f 0x00402e7d
0x00402e7d 0x00402e86 00:0000 9 j 0x00403850 f 0x00402e86
0x00402e86 0x00402e92 00:0000 12 j 0x00403850
0x00402e92 0x00402e9e 00:0000 12 j 0x00403850
0x00402e9e 0x00402eaa 00:0000 12 j 0x00403850
0x00402eaa 0x00402eb9 00:0000 15 j 0x00403850
0x00402eb9 0x00402ec5 00:0000 12 j 0x00403850
0x00402ec5 0x00402eca 00:0000 5 j 0x00402ef6 f 0x00402eca
0x00402eca 0x00402ee4 00:0000 26 j 0x00403850 f 0x00402ee4
0x00402ee4 0x00402ef6 00:0000 18 j 0x00403850
0x00402ef6 0x00402f11 00:0000 27 j 0x00403850
0x00402f11 0x00402f1c 00:0000 11 j 0x00403850
0x00402f1c 0x00402f21 00:0000 5 j 0x00402f47 f 0x00402f21
0x00402f21 0x00402f3b 00:0000 26 j 0x00403850 f 0x00402f3b
0x00402f3b 0x00402f47 00:0000 12 j 0x00403850
0x00402f47 0x00402f62 00:0000 27 j 0x00403850
0x00402f62 0x00402f67 00:0000 5 j 0x00402fbc f 0x00402f67
0x00402f67 0x00402f6c 00:0000 5 j 0x00402fb0 f 0x00402f6c
0x00402f6c 0x00402f71 00:0000 5 j 0x00402f89 f 0x00402f71
0x00402f71 0x00402f7a 00:0000 9 j 0x00403850 f 0x00402f7a
0x00402f7a 0x00402f89 00:0000 15 j 0x00403850
0x00402f89 0x00402f8e 00:0000 5 j 0x00402fa4 f 0x00402f8e
0x00402f8e 0x00402fa4 00:0000 22 j 0x00403850
0x00402fa4 0x00402fb0 00:0000 12 j 0x00403850
0x00402fb0 0x00402fbc 00:0000 12 j 0x00403850
0x00402fbc 0x00402fc2 00:0000 6 j 0x00402fe0 f 0x00402fc2
0x00402fc2 0x00402fc8 00:0000 6 j 0x00402fe0 f 0x00402fc8
0x00402fc8 0x00402fe0 00:0000 24 j 0x00403850
0x00402fe0 0x00402fe4 00:0000 4 j 0x00403002 f 0x00402fe4
0x00402fe4 0x00402fea 00:0000 6 j 0x00403002 f 0x00402fea
0x00402fea 0x00403002 00:0000 24 j 0x00403850
0x00403002 0x0040300a 00:0000 8 j 0x00403850 f 0x0040300a
0x0040300a 0x00403012 00:0000 8 j 0x00403850 f 0x00403012
0x00403012 0x0040301a 00:0000 8 j 0x00403850 f 0x0040301a
0x0040301a 0x00403022 00:0000 8 j 0x00403850 f 0x00403022
0x00403022 0x0040302a 00:0000 8 j 0x00403850 f 0x0040302a
0x0040302a 0x00403032 00:0000 8 j 0x00403850 f 0x00403032
0x00403032 0x00403038 00:0000 6 j 0x00403038
0x00403038 0x0040305a 00:0000 34 j 0x0040307c f 0x0040305a
0x0040305a 0x0040307c 00:0000 34 j 0x00402d2c f 0x0040307c
0x0040307c 0x00403092 00:0000 22 j 0x00403850
0x00403092 0x0040309e 00:0000 12 j 0x00403254 f 0x0040309e
0x0040309e 0x004030a4 00:0000 6 j 0x004032fc f 0x004030a4
0x004030a4 0x004030ad 00:0000 9 j 0x00403167 f 0x004030ad
0x004030ad 0x004030af 00:0000 2 j 0x004030fb f 0x004030af
0x004030af 0x004030b4 00:0000 5 j 0x004030c4 f 0x004030b4
0x004030b4 0x004030b8 00:0000 4 j 0x004030dc f 0x004030b8
0x004030b8 0x004030bc 00:0000 4 j 0x004030c4 f 0x004030bc
0x004030bc 0x004030c4 00:0000 8 j 0x0040366f f 0x004030c4
0x004030c4 0x004030dc 00:0000 24 j 0x00403332
0x004030dc 0x004030ec 00:0000 16 j 0x0040318a f 0x004030ec
0x004030ec 0x004030fb 00:0000 15 j 0x0040318a
0x004030fb 0x00403107 00:0000 12 j 0x00403111 f 0x00403107
0x00403107 0x00403111 00:0000 10 j 0x00403111
0x00403111 0x0040311c 00:0000 11 j 0x00403121 f 0x0040311c
0x0040311c 0x00403121 00:0000 5 j 0x00403121
0x00403121 0x00403143 00:0000 34 j 0x00403641 f 0x00403143
0x00403143 0x00403147 00:0000 4 j 0x00403152 f 0x00403147
0x00403147 0x00403152 00:0000 11 j 0x00403152
0x00403152 0x00403167 00:0000 21 j 0x00403633
0x00403167 0x00403170 00:0000 9 j 0x00403492 f 0x00403170
0x00403170 0x00403174 00:0000 4 j 0x004031f3 f 0x00403174
0x00403174 0x0040317c 00:0000 8 j 0x00403332 f 0x0040317c
0x0040317c 0x00403184 00:0000 8 j 0x0040366f f 0x00403184
0x00403184 0x0040318a 00:0000 6 j 0x0040318a
0x0040318a 0x0040319f 00:0000 21 j 0x004031cf f 0x0040319f
0x0040319f 0x004031c3 00:0000 36 j 0x004031e2 f 0x004031c3
0x004031c3 0x004031cf 00:0000 12 j 0x004031e2
0x004031cf 0x004031e2 00:0000 19 j 0x004031e2
0x004031e2 0x004031f3 00:0000 17 j 0x0040366f
0x004031f3 0x00403202 00:0000 15 j 0x0040323d f 0x00403202
0x00403202 0x00403209 00:0000 7 j 0x0040323d f 0x00403209
0x00403209 0x0040321e 00:0000 21 j 0x00403232 f 0x0040321e
0x0040321e 0x00403232 00:0000 20 j 0x00403669
0x00403232 0x0040323d 00:0000 11 j 0x00403669
0x0040323d 0x00403249 00:0000 12 j 0x00403249
0x00403249 0x00403254 00:0000 11 j 0x00403669
0x00403254 0x0040325d 00:0000 9 j 0x0040349a f 0x0040325d
0x0040325d 0x00403263 00:0000 6 j 0x00403488 f 0x00403263
0x00403263 0x0040326c 00:0000 9 j 0x0040366f f 0x0040326c
0x0040326c 0x00403275 00:0000 9 j 0x0040332c f 0x00403275
0x00403275 0x0040327a 00:0000 5 j 0x004032f6 f 0x0040327a
0x0040327a 0x0040327f 00:0000 5 j 0x004032ad f 0x0040327f
0x0040327f 0x00403288 00:0000 9 j 0x0040366f f 0x00403288
0x00403288 0x004032a1 00:0000 25 j 0x0040330d f 0x004032a1
0x004032a1 0x004032ad 00:0000 12 j 0x0040330d
0x004032ad 0x004032ca 00:0000 29 j 0x00402d2c f 0x004032ca
0x004032ca 0x004032d3 00:0000 9 j 0x004032df f 0x004032d3
0x004032d3 0x004032df 00:0000 12 j 0x004032e7
0x004032df 0x004032e7 00:0000 8 j 0x004032e7
0x004032e7 0x004032f6 00:0000 15 j 0x00403834
0x004032f6 0x004032fc 00:0000 6 j 0x004032fc
0x004032fc 0x00403303 00:0000 7 j 0x00403303
0x00403303 0x0040330d 00:0000 10 j 0x0040330d
0x0040330d 0x0040331f 00:0000 18 j 0x004034ff f 0x0040331f
0x0040331f 0x0040332c 00:0000 13 j 0x00403538
0x0040332c 0x00403332 00:0000 6 j 0x00403332
0x00403332 0x00403358 00:0000 38 j 0x00403364 f 0x00403358
0x00403358 0x00403364 00:0000 12 j 0x004033ce
0x00403364 0x00403366 00:0000 2 j 0x00403377 f 0x00403366
0x00403366 0x0040336b 00:0000 5 j 0x004033ce f 0x0040336b
0x0040336b 0x00403377 00:0000 12 j 0x004033ce
0x00403377 0x0040337f 00:0000 8 j 0x00403385 f 0x0040337f
0x0040337f 0x00403385 00:0000 6 j 0x00403385
0x00403385 0x00403391 00:0000 12 j 0x004033ce f 0x00403391
0x00403391 0x004033b4 00:0000 35 j 0x004033c4 f 0x004033b4
0x004033b4 0x004033c4 00:0000 16 j 0x004033ce
0x004033c4 0x004033ce 00:0000 10 j 0x004033ce
0x004033ce 0x0040342e 00:0000 96 j 0x0040344b f 0x0040342e
0x0040342e 0x00403437 00:0000 9 j 0x0040344b f 0x00403437
0x00403437 0x0040344b 00:0000 20 j 0x0040344b
0x0040344b 0x00403454 00:0000 9 j 0x0040346c f 0x00403454
0x00403454 0x00403458 00:0000 4 j 0x0040346c f 0x00403458
0x00403458 0x0040346c 00:0000 20 j 0x0040346c
0x0040346c 0x00403471 00:0000 5 j 0x00403482 f 0x00403471
0x00403471 0x00403482 00:0000 17 j 0x00403482
0x00403482 0x00403488 00:0000 6 j 0x00403249
0x00403488 0x00403492 00:0000 10 j 0x00403492
0x00403492 0x0040349a 00:0000 8 j 0x004034c4
0x0040349a 0x004034a3 00:0000 9 j 0x00403111 f 0x004034a3
0x004034a3 0x004034ab 00:0000 8 j 0x00403303 f 0x004034ab
0x004034ab 0x004034b4 00:0000 9 j 0x0040366f f 0x004034b4
0x004034b4 0x004034c4 00:0000 16 j 0x004034c4
0x004034c4 0x004034db 00:0000 23 j 0x0040330d f 0x004034db
0x004034db 0x004034ff 00:0000 36 j 0x0040330d
0x004034ff 0x0040350b 00:0000 12 j 0x0040331f f 0x0040350b
0x0040350b 0x00403513 00:0000 8 j 0x0040352b f 0x00403513
0x00403513 0x0040351e 00:0000 11 j 0x00403524 f 0x0040351e
0x0040351e 0x00403524 00:0000 6 j 0x00403528
0x00403524 0x00403528 00:0000 4 j 0x00403528
0x00403528 0x0040352b 00:0000 3 j 0x0040353e
0x0040352b 0x00403533 00:0000 8 j 0x00403536 f 0x00403533
0x00403533 0x00403536 00:0000 3 j 0x00403538
0x00403536 0x00403538 00:0000 2 j 0x00403538
0x00403538 0x0040353e 00:0000 6 j 0x0040353e
0x0040353e 0x00403543 00:0000 5 j 0x0040355d f 0x00403543
0x00403543 0x00403547 00:0000 4 j 0x0040355d f 0x00403547
0x00403547 0x00403549 00:0000 2 j 0x0040354d f 0x00403549
0x00403549 0x0040354d 00:0000 4 j 0x0040355d f 0x0040354d
0x0040354d 0x0040355d 00:0000 16 j 0x0040355d
0x0040355d 0x0040356d 00:0000 16 j 0x0040356f f 0x0040356d
0x0040356d 0x0040356f 00:0000 2 j 0x0040356f
0x0040356f 0x00403577 00:0000 8 j 0x00403583 f 0x00403577
0x00403577 0x00403583 00:0000 12 j 0x0040359d
0x00403583 0x00403597 00:0000 20 j 0x0040359d f 0x00403597
0x00403597 0x0040359d 00:0000 6 j 0x0040359d
0x0040359d 0x004035a3 00:0000 6 j 0x004035a9 f 0x004035a3
0x004035a3 0x004035a9 00:0000 6 j 0x004035a9
0x004035a9 0x004035ac 00:0000 3 j 0x004035ac
0x004035ac 0x004035bc 00:0000 16 j 0x004035c2 f 0x004035bc
0x004035bc 0x004035c2 00:0000 6 j 0x004035ef f 0x004035c2
0x004035c2 0x004035e4 00:0000 34 j 0x004035ea f 0x004035e4
0x004035e4 0x004035ea 00:0000 6 j 0x004035ea
0x004035ea 0x004035ef 00:0000 5 j 0x004035ac
0x004035ef 0x0040360d 00:0000 30 j 0x0040366f f 0x0040360d
0x0040360d 0x00403611 00:0000 4 j 0x00403618 f 0x00403611
0x00403611 0x00403618 00:0000 7 j 0x0040366f f 0x00403618
0x00403618 0x0040362a 00:0000 18 j 0x00403669
0x0040362a 0x00403630 00:0000 6 j 0x00403637 f 0x00403630
0x00403630 0x00403633 00:0000 3 j 0x00403633
0x00403633 0x00403637 00:0000 4 j 0x0040362a f 0x00403637
0x00403637 0x00403641 00:0000 10 j 0x00403669
0x00403641 0x00403645 00:0000 4 j 0x00403650 f 0x00403645
0x00403645 0x00403650 00:0000 11 j 0x00403650
0x00403650 0x00403658 00:0000 8 j 0x0040365f
0x00403658 0x0040365e 00:0000 6 j 0x00403663 f 0x0040365e
0x0040365e 0x0040365f 00:0000 1 j 0x0040365f
0x0040365f 0x00403663 00:0000 4 j 0x00403658 f 0x00403663
0x00403663 0x00403669 00:0000 6 j 0x00403669
0x00403669 0x0040366f 00:0000 6 j 0x0040366f
0x0040366f 0x0040367c 00:0000 13 j 0x00403834 f 0x0040367c
0x0040367c 0x00403687 00:0000 11 j 0x004036bc f 0x00403687
0x00403687 0x0040368f 00:0000 8 j 0x00403698 f 0x0040368f
0x0040368f 0x00403698 00:0000 9 j 0x004036b2
0x00403698 0x0040369d 00:0000 5 j 0x004036a6 f 0x0040369d
0x0040369d 0x004036a6 00:0000 9 j 0x004036b2
0x004036a6 0x004036ab 00:0000 5 j 0x004036bc f 0x004036ab
0x004036ab 0x004036b2 00:0000 7 j 0x004036b2
0x004036b2 0x004036bc 00:0000 10 j 0x004036bc
0x004036bc 0x004036d9 00:0000 29 j 0x004036fe f 0x004036d9
0x004036d9 0x004036dd 00:0000 4 j 0x004036fa
0x004036dd 0x004036fa 00:0000 29 j 0x004036fe f 0x004036fa
0x004036fa 0x004036fe 00:0000 4 j 0x004036dd f 0x004036fe
0x004036fe 0x0040372d 00:0000 47 j 0x0040375b f 0x0040372d
0x0040372d 0x00403736 00:0000 9 j 0x0040375b f 0x00403736
0x00403736 0x0040373e 00:0000 8 j 0x00403757
0x0040373e 0x00403757 00:0000 25 j 0x0040375b f 0x00403757
0x00403757 0x0040375b 00:0000 4 j 0x0040373e f 0x0040375b
0x0040375b 0x0040376a 00:0000 15 j 0x004037df f 0x0040376a
0x0040376a 0x0040376e 00:0000 4 j 0x004037df f 0x0040376e
0x0040376e 0x0040377a 00:0000 12 j 0x0040377a
0x0040377a 0x004037a0 00:0000 38 j 0x004037d6 f 0x004037a0
0x004037a0 0x004037a8 00:0000 8 j 0x004037d6 f 0x004037a8
0x004037a8 0x004037d4 00:0000 44 j 0x0040377a f 0x004037d4
0x004037d4 0x004037d6 00:0000 2 j 0x004037f9
0x004037d6 0x004037df 00:0000 9 j 0x004037f9
0x004037df 0x004037f9 00:0000 26 j 0x004037f9
0x004037f9 0x00403802 00:0000 9 j 0x00403834 f 0x00403802
0x00403802 0x0040380b 00:0000 9 j 0x00403834 f 0x0040380b
0x0040380b 0x00403813 00:0000 8 j 0x00403830
0x00403813 0x00403830 00:0000 29 j 0x00403834 f 0x00403830
0x00403830 0x00403834 00:0000 4 j 0x00403813 f 0x00403834
0x00403834 0x0040383d 00:0000 9 j 0x00403850 f 0x0040383d
0x0040383d 0x00403850 00:0000 19 j 0x00403850
0x00403850 0x00403862 00:0000 18 j 0x00403875 f 0x00403862
0x00403862 0x00403875 00:0000 19 j 0x00402de7
0x00403875 0x0040387e 00:0000 9 j 0x00403888 f 0x0040387e
0x0040387e 0x00403888 00:0000 10 j 0x00403888
0x00403888 0x0040388e 00:0000 6 j 0x0040388e
0x0040388e 0x0040389d 00:0000 15
'
run_test

# This output is WIP, but its used as a sign of "it works"
FILE=../../bins/mach0/ls-osx-x86_64
CMDS='e anal.jmptbl=true
af
f~switch

'
EXPECT='0x100001527 1 switch.0x100001527
'
run_test

FILE=../../bins/pe/ConsoleApplication1.exe
CMDS='e anal.jmptbl=true
s 0x401090
af
afb

'
EXPECT='0x00401090 0x004010d2 00:0000 66 j 0x004010e8 f 0x004010d2
0x004010d2 0x004010e8 00:0000 22
0x004010e8 0x00401103 00:0000 27 j 0x00401103
0x00401103 0x0040110e 00:0000 11 j 0x0040116b f 0x0040110e
0x0040110e 0x00401115 00:0000 7 j 0x0040114f f 0x00401115
0x00401115 0x00401119 00:0000 4 j 0x00401123 f 0x00401119
0x00401119 0x00401123 00:0000 10 j 0x00401123
0x00401123 0x00401138 00:0000 21 j 0x00401103 f 0x00401138
0x00401138 0x0040114f 00:0000 23
0x0040114f 0x0040116b 00:0000 28
0x0040116b 0x00401173 00:0000 8 j 0x004011e5 f 0x00401173
0x00401173 0x00401182 00:0000 15 j 0x00401182
0x00401182 0x0040118a 00:0000 8 j 0x004011c8 f 0x0040118a
0x0040118a 0x00401191 00:0000 7
0x00401191 0x00401196 00:0000 5 j 0x004011d8
0x00401196 0x004011a6 00:0000 16 j 0x004011d8
0x004011a6 0x004011ac 00:0000 6 j 0x004011b1 f 0x004011ac
0x004011ac 0x004011b1 00:0000 5 j 0x004011d8
0x004011b1 0x004011b5 00:0000 4 j 0x004011ba f 0x004011b5
0x004011b5 0x004011ba 00:0000 5 j 0x004011d8
0x004011ba 0x004011be 00:0000 4 j 0x004011d8 f 0x004011be
0x004011be 0x004011c3 00:0000 5 j 0x004011d8
0x004011c3 0x004011c8 00:0000 5 j 0x004011d8
0x004011c8 0x004011d8 00:0000 16 j 0x004011d8
0x004011d8 0x004011e2 00:0000 10 j 0x00401182 f 0x004011e2
0x004011e2 0x004011e5 00:0000 3 j 0x004011e5
0x004011e5 0x00401249 00:0000 100
'
run_test


NAME="ls_amd64 all switches"
FILE=../../bins/jmptbl/ls_amd64
ARGS='-e anal.jmptbl=true'
CMDS='aaa
CC. @@ switch
'
EXPECT='switch table (275 cases) at 0x4140b0
switch table (54 cases) at 0x41a048
switch table (54 cases) at 0x419e98
switch table (5 cases) at 0x414088
switch table (121 cases) at 0x413cc0
switch table (54 cases) at 0x41a418
switch table (54 cases) at 0x41a268
switch table (127 cases) at 0x418e58
switch table (11 cases) at 0x418e00
switch table (123 cases) at 0x4196f0
switch table (123 cases) at 0x419318
switch table (10 cases) at 0x419dc0
'
run_test

NAME="gcc_5.5.0_64 switch/case flags"
FILE=../../bins/jmptbl/test_gcc_5.5.0_64.out
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x0000059d 1 switch.0x0000059d
0x00000622 1 case.0x59d.0
0x000005b2 1 case.0x59d.1
0x000005c0 1 case.0x59d.2
0x000005c0 1 case.0x59d.3
0x000005c0 1 case.0x59d.4
0x000005ce 1 case.0x59d.5
0x000005dc 1 case.0x59d.6
0x000005ea 1 case.0x59d.7
0x00000622 1 case.0x59d.8
0x000005f8 1 case.0x59d.9
0x00000622 1 case.0x59d.10
0x00000606 1 case.0x59d.11
0x00000614 1 case.0x59d.12
0x0000059f 1 case.0x59d.13
0x00000622 1 case.default.0x622
'
run_test

NAME="gcc_7.2.0_64 switch/case flags"
FILE=../../bins/jmptbl/test_gcc_7.2.0_64.out
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x0000054d 1 switch.0x0000054d
0x000005d2 1 case.0x54d.0
0x00000562 1 case.0x54d.1
0x00000570 1 case.0x54d.2
0x00000570 1 case.0x54d.3
0x00000570 1 case.0x54d.4
0x0000057e 1 case.0x54d.5
0x0000058c 1 case.0x54d.6
0x0000059a 1 case.0x54d.7
0x000005d2 1 case.0x54d.8
0x000005a8 1 case.0x54d.9
0x000005d2 1 case.0x54d.10
0x000005b6 1 case.0x54d.11
0x000005c4 1 case.0x54d.12
0x0000054f 1 case.0x54d.13
0x000005d2 1 case.default.0x5d2
'
run_test

NAME="clang_3.8_32 switch/case flags"
FILE=../../bins/jmptbl/test_clang_3.8_32.out
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x080483fd 1 switch.0x080483fd
0x0804840d 1 case.0x80483fd.0
0x08048404 1 case.0x80483fd.1
0x08048404 1 case.0x80483fd.2
0x08048404 1 case.0x80483fd.3
0x08048416 1 case.0x80483fd.4
0x0804841f 1 case.0x80483fd.5
0x08048428 1 case.0x80483fd.6
0x08048431 1 case.0x80483fd.7
0x0804843a 1 case.0x80483fd.8
0x08048431 1 case.0x80483fd.9
0x08048443 1 case.0x80483fd.10
0x0804844c 1 case.0x80483fd.11
0x08048455 1 case.0x80483fd.12
0x08048431 1 case.default.0x8048431
'
run_test

NAME="clang_3.8_64 switch/case flags"
FILE=../../bins/jmptbl/test_clang_3.8_64.out
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x004004d8 1 switch.0x004004d8
0x004004e6 1 case.0x4004d8.0
0x004004df 1 case.0x4004d8.1
0x004004df 1 case.0x4004d8.2
0x004004df 1 case.0x4004d8.3
0x004004ed 1 case.0x4004d8.4
0x004004f4 1 case.0x4004d8.5
0x004004fb 1 case.0x4004d8.6
0x00400502 1 case.0x4004d8.7
0x00400509 1 case.0x4004d8.8
0x00400502 1 case.0x4004d8.9
0x00400510 1 case.0x4004d8.10
0x00400517 1 case.0x4004d8.11
0x0040051e 1 case.0x4004d8.12
0x00400502 1 case.default.0x400502
'
run_test

NAME="clang_5.0_32 switch/case flags"
FILE=../../bins/jmptbl/test_clang_5.0_32.out
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x080483fd 1 switch.0x080483fd
0x0804840d 1 case.0x80483fd.0
0x08048404 1 case.0x80483fd.1
0x08048404 1 case.0x80483fd.2
0x08048404 1 case.0x80483fd.3
0x08048416 1 case.0x80483fd.4
0x0804841f 1 case.0x80483fd.5
0x08048428 1 case.0x80483fd.6
0x08048431 1 case.0x80483fd.7
0x0804843a 1 case.0x80483fd.8
0x08048431 1 case.0x80483fd.9
0x08048443 1 case.0x80483fd.10
0x0804844c 1 case.0x80483fd.11
0x08048455 1 case.0x80483fd.12
0x08048431 1 case.default.0x8048431
'
run_test

NAME="clang_5.0_64 switch/case flags"
FILE=../../bins/jmptbl/test_clang_5.0_64.out
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x004004c8 1 switch.0x004004c8
0x004004d6 1 case.0x4004c8.0
0x004004cf 1 case.0x4004c8.1
0x004004cf 1 case.0x4004c8.2
0x004004cf 1 case.0x4004c8.3
0x004004dd 1 case.0x4004c8.4
0x004004e4 1 case.0x4004c8.5
0x004004eb 1 case.0x4004c8.6
0x004004f2 1 case.0x4004c8.7
0x004004f9 1 case.0x4004c8.8
0x004004f2 1 case.0x4004c8.9
0x00400500 1 case.0x4004c8.10
0x00400507 1 case.0x4004c8.11
0x0040050e 1 case.0x4004c8.12
0x004004f2 1 case.default.0x4004f2
'
run_test

NAME="msvc_1700_64 switch/case flags"
FILE=../../bins/jmptbl/test_msvc_1700_64.exe
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x140001023 1 switch.0x140001023
0x140004b01 1 switch.0x140004b01
0x140001025 1 case.0x140001023.0
0x140001038 1 case.0x140001023.1
0x140001038 1 case.0x140001023.2
0x140001038 1 case.0x140001023.3
0x14000104b 1 case.0x140001023.4
0x14000105e 1 case.0x140001023.5
0x140001071 1 case.0x140001023.6
0x1400010d0 1 case.0x140001023.7
0x140001084 1 case.0x140001023.8
0x1400010d0 1 case.0x140001023.9
0x140001097 1 case.0x140001023.10
0x1400010aa 1 case.0x140001023.11
0x1400010bd 1 case.0x140001023.12
0x1400010d0 1 case.default.0x1400010d0
0x140004b47 1 case.0x140004b01.0
0x140004b4b 1 case.0x140004b01.1
0x140004b56 1 case.0x140004b01.2
0x140004b62 1 case.0x140004b01.3
0x140004b77 1 case.0x140004b01.4
0x140004b80 1 case.0x140004b01.5
0x140004b92 1 case.0x140004b01.6
0x140004ba5 1 case.0x140004b01.7
0x140004bc1 1 case.0x140004b01.8
0x140004bcb 1 case.0x140004b01.9
0x140004bde 1 case.0x140004b01.10
0x140004bf2 1 case.0x140004b01.11
0x140004c0f 1 case.0x140004b01.12
0x140004c20 1 case.0x140004b01.13
0x140004c3a 1 case.0x140004b01.14
0x140004c55 1 case.0x140004b01.15
0x140004c79 1 case.0x140004b01.16
0x140004a40 1 case.default.0x140004a40
'
run_test

NAME="msvc_1900_32 switch/case flags"
FILE=../../bins/jmptbl/test_msvc_1900_32.exe
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x0040100e 1 switch.0x0040100e
0x0040beb5 1 switch.0x0040beb5
0x0040bf68 1 switch.0x0040bf68
0x00401015 1 case.0x40100e.0
0x00401025 1 case.0x40100e.1
0x00401025 1 case.0x40100e.2
0x00401025 1 case.0x40100e.3
0x00401035 1 case.0x40100e.4
0x00401045 1 case.0x40100e.5
0x00401055 1 case.0x40100e.6
0x004010a5 1 case.0x40100e.7
0x00401065 1 case.0x40100e.8
0x004010a5 1 case.0x40100e.9
0x00401075 1 case.0x40100e.10
0x00401085 1 case.0x40100e.11
0x00401095 1 case.0x40100e.12
0x004010a5 1 case.default.0x4010a5
0x0040bed4 1 case.0x40beb5.0
0x0040bedc 1 case.0x40beb5.1
0x0040bee8 1 case.0x40beb5.2
0x0040befc 1 case.0x40beb5.3
0x0040c15b 1 case.default.0x40c15b
0x0040bf80 1 case.0x40bf68.0
0x0040bf88 1 case.0x40bf68.1
0x0040bf98 1 case.0x40bf68.2
0x0040bfac 1 case.0x40bf68.3
0x0040c074 1 case.default.0x40c074
'
run_test

NAME="msvc_1900_64 switch/case flags"
FILE=../../bins/jmptbl/test_msvc_1900_64.exe
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x140001023 1 switch.0x140001023
0x14000c185 1 switch.0x14000c185
0x1400095b4 1 switch.0x1400095b4
0x140001025 1 case.0x140001023.0
0x140001038 1 case.0x140001023.1
0x140001038 1 case.0x140001023.2
0x140001038 1 case.0x140001023.3
0x14000104b 1 case.0x140001023.4
0x14000105e 1 case.0x140001023.5
0x140001071 1 case.0x140001023.6
0x1400010d0 1 case.0x140001023.7
0x140001084 1 case.0x140001023.8
0x1400010d0 1 case.0x140001023.9
0x140001097 1 case.0x140001023.10
0x1400010aa 1 case.0x140001023.11
0x1400010bd 1 case.0x140001023.12
0x1400010d0 1 case.default.0x1400010d0
0x14000c1d0 1 case.0x14000c185.0
0x14000c1ef 1 case.0x14000c185.1
0x14000c1d1 1 case.0x14000c185.2
0x14000c1df 1 case.0x14000c185.3
0x14000c21b 1 case.0x14000c185.4
0x14000c220 1 case.0x14000c185.5
0x14000c230 1 case.0x14000c185.6
0x14000c240 1 case.0x14000c185.7
0x14000c1d8 1 case.0x14000c185.8
0x14000c270 1 case.0x14000c185.9
0x14000c280 1 case.0x14000c185.10
0x14000c200 1 case.0x14000c185.11
0x14000c290 1 case.0x14000c185.12
0x14000c258 1 case.0x14000c185.13
0x14000c2a0 1 case.0x14000c185.14
0x14000c2c0 1 case.0x14000c185.15
0x14000c1f5 1 case.0x14000c185.16
0x14000c100 1 case.default.0x14000c100
0x1400095b6 1 case.0x1400095b4.0
0x1400095bd 1 case.0x1400095b4.1
0x1400095c4 1 case.0x1400095b4.2
0x1400095cb 1 case.0x1400095b4.3
0x1400095d2 1 case.0x1400095b4.4
0x1400095d9 1 case.0x1400095b4.5
0x1400095e0 1 case.0x1400095b4.6
0x1400095e7 1 case.0x1400095b4.7
0x1400095ee 1 case.0x1400095b4.8
0x1400095f5 1 case.0x1400095b4.9
0x1400095fc 1 case.0x1400095b4.10
0x140009603 1 case.0x1400095b4.11
0x14000960a 1 case.0x1400095b4.12
0x140009611 1 case.0x1400095b4.13
0x140009618 1 case.0x1400095b4.14
0x14000961d 1 case.default.0x14000961d
'
run_test

NAME="msvc_1913_32 switch/case flags"
FILE=../../bins/jmptbl/test_msvc_1913_32.exe
ARGS='-e anal.jmptbl=true -A'
CMDS='f~switch
f~case.
'
EXPECT='0x0040100e 1 switch.0x0040100e
0x004028a5 1 switch.0x004028a5
0x00402958 1 switch.0x00402958
0x00401015 1 case.0x40100e.0
0x00401026 1 case.0x40100e.1
0x00401026 1 case.0x40100e.2
0x00401026 1 case.0x40100e.3
0x00401037 1 case.0x40100e.4
0x00401048 1 case.0x40100e.5
0x00401059 1 case.0x40100e.6
0x004010ae 1 case.0x40100e.7
0x0040106a 1 case.0x40100e.8
0x004010ae 1 case.0x40100e.9
0x0040107b 1 case.0x40100e.10
0x0040108c 1 case.0x40100e.11
0x0040109d 1 case.0x40100e.12
0x004010ae 1 case.default.0x4010ae
0x004028c4 1 case.0x4028a5.0
0x004028cc 1 case.0x4028a5.1
0x004028d8 1 case.0x4028a5.2
0x004028ec 1 case.0x4028a5.3
0x00402b4b 1 case.default.0x402b4b
0x00402970 1 case.0x402958.0
0x00402978 1 case.0x402958.1
0x00402988 1 case.0x402958.2
0x0040299c 1 case.0x402958.3
0x00402a64 1 case.default.0x402a64
'
run_test
